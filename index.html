<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç”Ÿå‘½éˆæ•¸ Â· å°å°è¦ºå¯Ÿå…¥å£</title>
  <style>
    /* ====== åŸºæœ¬ç‰ˆé¢è¨­å®š ====== */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
        sans-serif;
      background: radial-gradient(circle at top, #fdf2ff, #f5f5f5);
      color: #222;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      background: #ffffffdd;
      backdrop-filter: blur(8px);
      border-radius: 20px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
      padding: 24px 20px 20px;
      margin: 16px;
    }

    .app-header {
      margin-bottom: 16px;
    }

    .app-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      font-size: 0.8rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #e0d4ff;
      background: #f7f3ff;
      color: #5b3fd1;
    }

    .streak-badge {
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
      color: #6b4700;
      font-weight: 600;
      margin-left: auto;
    }

    .app-subtitle {
      font-size: 0.9rem;
      color: #777;
      margin: 0;
    }

    /* ====== è¡¨å–® ====== */
    .card {
      border-radius: 16px;
      border: 1px solid #eee;
      padding: 16px 14px;
      margin-bottom: 14px;
      background: #fff;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 6px;
      color: #555;
    }

    .field-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    input[type="date"] {
      flex: 1;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 0.95rem;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #6c5ce7, #a66bff);
      color: #fff;
      box-shadow: 0 8px 20px rgba(93, 76, 255, 0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        opacity 0.12s ease;
      white-space: nowrap;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 4px 12px rgba(93, 76, 255, 0.35);
      opacity: 0.9;
    }

    /* ====== çµæœå¡ç‰‡ ====== */
    .result {
      display: none; /* ä¸€é–‹å§‹å…ˆéš±è—ï¼Œè¨ˆç®—å¾Œå†é¡¯ç¤º */
      margin-top: 6px;
    }

    .result.show {
      display: block;
    }

    .number-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #f3edff;
      color: #5b3fd1;
      font-size: 1.3rem;
      font-weight: 700;
      margin-right: 10px;
    }

    .result-title-row {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }

    .result-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #999;
      margin-bottom: 2px;
    }

    .result-name {
      font-size: 1rem;
      font-weight: 600;
    }

    .result-tagline {
      font-size: 0.9rem;
      color: #666;
      margin-top: 2px;
    }

    .result-desc {
      font-size: 0.9rem;
      color: #444;
      margin-top: 10px;
      line-height: 1.5;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .chip {
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #eee;
      background: #fafafa;
      color: #666;
    }

    /* ====== ä»Šæ—¥æç¤º ====== */
    .tip-card {
      border-radius: 16px;
      border: 1px dashed #ded3ff;
      padding: 12px 12px 10px;
      background: #fbf9ff;
      margin-top: 10px;
    }

    .tip-label {
      font-size: 0.8rem;
      color: #8a6eff;
      margin-bottom: 4px;
    }

    .tip-text {
      font-size: 0.9rem;
      color: #51416f;
      line-height: 1.5;
    }

    /* ====== æƒ…ç·’ç´€éŒ„ ====== */
    .mood-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      font-size: 0.85rem;
      color: #666;
    }

    .mood-buttons button {
      background: #f5f5f5;
      color: #555;
      box-shadow: none;
      padding: 4px 8px;
      font-size: 1.1rem;
    }

    .mood-buttons button.selected {
      background: #ffeaa7;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 0.75rem;
      color: #aaa;
      line-height: 1.4;
    }

    /* ====== èŠ±åœ’å…¥å£é€£çµ ====== */
    .garden-link {
      text-align: center;
      margin: 16px 0 8px;
      padding: 12px;
      background: linear-gradient(135deg, #f0e8ff, #fdf2ff);
      border-radius: 12px;
      border: 1px dashed #d8b4ff;
    }

    .garden-link a {
      display: inline-block;
      padding: 10px 20px;
      background: linear-gradient(135deg, #d8b4ff, #9f7aea);
      color: white;
      text-decoration: none;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow: 0 4px 12px rgba(159, 122, 234, 0.3);
      transition: all 0.2s;
    }

    .garden-link a:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(159, 122, 234, 0.4);
    }

    .garden-link p {
      margin: 8px 0 0;
      font-size: 0.8rem;
      color: #9f7aea;
      line-height: 1.4;
    }

    /* ====== ä»Šæ—¥èƒ½é‡å¡ç‰‡ ====== */
    .energy-card {
      border-radius: 12px;
      border: 1px solid #e6dcff;
      padding: 12px;
      background: linear-gradient(135deg, #f9f5ff, #f0e8ff);
      margin-bottom: 12px;
    }

    .energy-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .energy-badge {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 60px;
    }

    .energy-label {
      font-size: 0.7rem;
      color: #8a6eff;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 4px;
    }

    .energy-number {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #9f7aea, #6c5ce7);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2);
    }

    .energy-desc {
      font-size: 0.85rem;
      color: #51416f;
      line-height: 1.4;
      flex: 1;
    }

    /* ====== æ­·å²ç´€éŒ„ ====== */
    .history-section {
      display: none;
      margin-top: 14px;
    }

    .history-section.show {
      display: block;
    }

    .history-header {
      font-size: 0.85rem;
      color: #777;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .history-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: #fafafa;
      border-radius: 10px;
      font-size: 0.85rem;
    }

    .history-date {
      color: #999;
      min-width: 80px;
    }

    .history-mood {
      font-size: 1rem;
    }

    .history-text {
      color: #666;
      flex: 1;
    }

    .empty-history {
      font-size: 0.85rem;
      color: #aaa;
      text-align: center;
      padding: 12px;
    }

    @media (max-width: 360px) {
      .app {
        padding: 18px 14px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <h1 class="app-title">
        ç”Ÿå‘½éˆæ•¸
        <span class="pill">è¦ºå¯Ÿå°å…¥å£</span>
        <span class="streak-badge" id="streak-badge" style="display: none;">
          ğŸ”¥ 0 å¤©
        </span>
      </h1>
      <p class="app-subtitle">
        ç”¨ä½ å…ˆæ‡‚çš„æ•¸å­—ï¼Œå¸¶ä½ å›åˆ°ä½ æœ¬ä¾†çš„æ¨£å­ã€‚
      </p>

      <!-- èŠ±åœ’å…¥å£ -->
      <div class="garden-link">
        <a href="blu-guarden.html">ğŸŒ¸ é€²å…¥ BLU å°èŠ±åœ’</a>
        <p>æƒ³è¦è®“é€™äº›è¦ºå¯Ÿè¢«æ°¸é è¨˜ä½ï¼Ÿ<br>é€²å…¥èŠ±åœ’ï¼Œç¨®ä¸‹ä½ çš„ç¬¬ä¸€é¡†ç¨®å­</p>
      </div>
    </header>

    <!-- è¼¸å…¥èˆ‡è¨ˆç®—å€ -->
    <section class="card">
      <label for="birthdate">ä½ çš„ç”Ÿæ—¥</label>
      <div class="field-row">
        <input type="date" id="birthdate" />
        <button id="calc-btn" type="button">è¨ˆç®—</button>
      </div>
    </section>

    <!-- é¡¯ç¤ºçµæœå€ -->
    <section class="card result" id="result-card">
      <div class="result-title-row">
        <div class="number-badge" id="life-number">?</div>
        <div>
          <div class="result-label">ä½ çš„ç”Ÿå‘½éˆæ•¸</div>
          <div class="result-name" id="life-title">â€”</div>
          <div class="result-tagline" id="life-tagline">â€”</div>
        </div>
      </div>

      <div class="chip-row">
        <span class="chip" id="life-keywords"></span>
      </div>

      <p class="result-desc" id="life-desc"></p>

      <!-- ä»Šæ—¥èƒ½é‡ -->
      <div class="energy-card">
        <div class="energy-row">
          <div class="energy-badge">
            <div class="energy-label">ä»Šæ—¥èƒ½é‡</div>
            <div class="energy-number" id="daily-energy-num">?</div>
          </div>
          <div class="energy-desc">
            <div style="font-weight: 600; margin-bottom: 2px;">
              <span id="daily-energy-name">â€”</span>
            </div>
            <div style="font-size: 0.8rem; color: #7a6ba8;">
              ä»Šå¤©çš„å®‡å®™æ•¸å­—
            </div>
          </div>
        </div>
      </div>

      <div class="tip-card">
        <div class="tip-label">ä»Šå¤©çš„å°å°æé†’</div>
        <div class="tip-text" id="life-tip">
          è«‹å…ˆè¼¸å…¥ç”Ÿæ—¥ï¼Œè®“æˆ‘å€‘çœ‹çœ‹ä»Šå¤©çš„ä½ é©åˆæ€éº¼å°é½Šè‡ªå·±ã€‚
        </div>
      </div>

      <div class="mood-row">
        <span>ä»Šå¤©çš„æ„Ÿè¦ºï¼š</span>
        <div class="mood-buttons">
          <button type="button" data-mood="good">ğŸ™‚</button>
          <button type="button" data-mood="ok">ğŸ˜</button>
          <button type="button" data-mood="bad">â˜¹ï¸</button>
        </div>
      </div>

      <div class="footer-note" id="mood-note">
        ï¼ˆé¸ä¸€å€‹è¡¨æƒ…ï¼Œè¨˜éŒ„ä¸€ä¸‹ä»Šå¤©çš„ä½ ï¼‰
      </div>

      <!-- æ­·å²ç´€éŒ„å€ -->
      <div class="history-section" id="history-section">
        <div class="history-header">
          ğŸ“Š æœ€è¿‘ 7 å¤©
        </div>
        <div class="history-list" id="history-list">
          <div class="empty-history">é‚„æ²’æœ‰ç´€éŒ„ï¼Œé¸å€‹å¿ƒæƒ…é–‹å§‹å§</div>
        </div>
      </div>
    </section>
  </div>

  <script src="combo-tips.js"></script>
  <script>
    // ====== LocalStorage å·¥å…·å‡½å¼ ======
    const STORAGE_KEY = {
      BIRTHDATE: 'lifepath_birthdate',
      MOOD_LOGS: 'lifepath_mood_logs',
      LIFE_NUMBER: 'lifepath_life_number'
    };

    function saveBirthdate(dateStr) {
      localStorage.setItem(STORAGE_KEY.BIRTHDATE, dateStr);
    }

    function loadBirthdate() {
      return localStorage.getItem(STORAGE_KEY.BIRTHDATE);
    }

    function saveLifeNumber(num) {
      localStorage.setItem(STORAGE_KEY.LIFE_NUMBER, num.toString());
    }

    function loadLifeNumber() {
      const num = localStorage.getItem(STORAGE_KEY.LIFE_NUMBER);
      return num ? parseInt(num) : null;
    }

    function loadMoodLogs() {
      const logs = localStorage.getItem(STORAGE_KEY.MOOD_LOGS);
      return logs ? JSON.parse(logs) : [];
    }

    function saveMoodLog(mood, lifeNumber) {
      const logs = loadMoodLogs();
      const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD

      // æª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²ç¶“è¨˜éŒ„éï¼Œå¦‚æœæœ‰å°±æ›´æ–°
      const existingIndex = logs.findIndex(log => log.date === today);

      const newLog = {
        date: today,
        mood: mood,
        lifeNumber: lifeNumber,
        timestamp: Date.now()
      };

      if (existingIndex >= 0) {
        logs[existingIndex] = newLog;
      } else {
        logs.push(newLog);
      }

      // åªä¿ç•™æœ€è¿‘ 30 å¤©çš„ç´€éŒ„
      const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
      const filteredLogs = logs.filter(log => log.timestamp > thirtyDaysAgo);

      localStorage.setItem(STORAGE_KEY.MOOD_LOGS, JSON.stringify(filteredLogs));
      return filteredLogs;
    }

    function calculateStreak() {
      const logs = loadMoodLogs();
      if (logs.length === 0) return 0;

      // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°åœ¨å‰ï¼‰
      logs.sort((a, b) => b.timestamp - a.timestamp);

      let streak = 0;
      let checkDate = new Date();

      for (let i = 0; i < logs.length; i++) {
        const logDate = logs[i].date;
        const expectedDate = checkDate.toISOString().split('T')[0];

        if (logDate === expectedDate) {
          streak++;
          checkDate.setDate(checkDate.getDate() - 1);
        } else {
          break;
        }
      }

      return streak;
    }

    // ====== è³‡æ–™å®šç¾©ï¼šæ¯å€‹ç”Ÿå‘½éˆæ•¸çš„åŸºæœ¬è³‡è¨Š ======
    const lifeData = {
      1: {
        title: "é–‹è·¯è€…",
        tagline: "å¤©ç”Ÿå¸¶è‘—ã€Œæˆ‘å…ˆä¾†ã€çš„èƒ½é‡ã€‚",
        keywords: "è¡Œå‹• / ä¸»å° / é–‹å‰µ",
        desc: "ä½ ä¾†åˆ°é€™è£¡ï¼Œæ˜¯ç‚ºäº†é–‹å‡ºåˆ¥äººé‚„æ²’èµ°éçš„è·¯ã€‚ç•¶ä½ å‹‡æ•¢åšè‡ªå·±ç›¸ä¿¡çš„äº‹æ™‚ï¼Œä¸–ç•Œåè€Œæœƒé¬†ä¸€å£æ°£ã€‚",
        tips: [
          "ä»Šå¤©è©¦è‘—æ›¿è‡ªå·±åšä¸€å€‹å°æ±ºå®šï¼Œä¸éœ€è¦ä»»ä½•äººåŒæ„ï¼Œæ¯”å¦‚ï¼šå®‰æ’ä¸€å€‹åªå±¬æ–¼ä½ çš„ 30 åˆ†é˜ã€‚",
          "ç•¶ä½ æ„Ÿè¦ºåˆ°ã€Œæ‡‰è©²ç­‰åˆ¥äººå…ˆå‹•ã€ï¼Œé‚£å°±æ˜¯ä½ è©²å…ˆå‹•çš„ä¿¡è™Ÿã€‚",
          "ä»Šå¤©åšä¸€ä»¶å°äº‹ï¼Œå®Œå…¨ç”¨ä½ çš„æ–¹å¼ï¼Œä¸è§£é‡‹ã€ä¸è¨å¥½ã€‚"
        ]
      },
      2: {
        title: "å”èª¿è€…",
        tagline: "ç•¶åˆ¥äººåªçœ‹å°éŒ¯ï¼Œä½ çœ‹ã€Œé—œä¿‚ã€ã€‚",
        keywords: "å‚¾è½ / é€£çµ / åˆä½œ",
        desc: "ä½ å¤©ç”Ÿèƒ½æ„Ÿè¦ºåˆ°ä»–äººæƒ…ç·’èˆ‡æ°£æ°›çš„è®ŠåŒ–ã€‚ç•¶ä½ å…è¨±è‡ªå·±æº«æŸ”ä½†ä¸å§”å±ˆï¼Œä½ å°±æˆäº†å ´åŸŸçœŸæ­£çš„å®ˆè­·è€…ã€‚",
        tips: [
          "ä»Šå¤©åˆ»æ„å°ä¸€å€‹äººå¤šå•ä¸€å¥ï¼šã€é‚£ä½ çœŸæ­£çš„æ„Ÿå—æ˜¯ä»€éº¼ï¼Ÿã€ç„¶å¾Œå®‰éœåœ°è½ã€‚",
          "ç•¶ä½ æ„Ÿè¦ºåˆ°ã€Œæˆ‘è©²é…åˆä¸€ä¸‹ã€æ™‚ï¼Œå…ˆå•è‡ªå·±ï¼šã€æˆ‘çœŸçš„æƒ³é…åˆå—ï¼Ÿã€",
          "ä»Šå¤©è©¦è‘—èªªä¸€æ¬¡ã€æˆ‘éœ€è¦æƒ³ä¸€ä¸‹ã€ï¼Œçµ¦è‡ªå·±ä¸€é»ç©ºé–“å†å›æ‡‰ã€‚"
        ]
      },
      3: {
        title: "è¡¨é”è€…",
        tagline: "ç”Ÿå‘½å°ä½ ä¾†èªªï¼Œæ˜¯ä¸€å€‹å¯ä»¥ç©è€çš„èˆå°ã€‚",
        keywords: "å‰µæ„ / è¡¨é” / ç©å¿ƒ",
        desc: "ä½ æ˜¯è®“æ°›åœè®Šå¾—è¼•ç›ˆã€æœ‰è¶£çš„äººã€‚ç•¶ä½ çœŸå¯¦åœ°åˆ†äº«ä½ çš„æ„Ÿå—èˆ‡æ•…äº‹ï¼Œåˆ¥äººæœƒå› æ­¤é¬†é–‹å¿ƒè£¡çš„ä¸€äº›çµã€‚",
        tips: [
          "ä»Šå¤©åˆ†äº«ä¸€ä»¶è®“ä½ æœƒå¿ƒä¸€ç¬‘çš„å°äº‹ï¼Œçµ¦ä¸€ä½ä½ æƒ³åˆ°çš„äººï¼Œä¸æ±‚æ·±åº¦ï¼Œåªæ±‚çœŸå¯¦ã€‚",
          "å¦‚æœä»Šå¤©æœ‰ä»€éº¼è©±æƒ³èªªä½†è¦ºå¾—ã€Œå¥½åƒä¸å¤ æ­£ç¶“ã€ï¼Œé‚£å°±æ›´è©²èªªã€‚",
          "ä»Šå¤©å…è¨±è‡ªå·±åšä¸€ä»¶ã€Œå¥½ç©ä½†æ²’ç”¨ã€çš„äº‹ï¼Œåƒå¡—é´‰ã€å“¼æ­Œã€å¯«å€‹ç„¡èŠçŸ­å¥ã€‚"
        ]
      },
      4: {
        title: "ç¯‰åŸºè€…",
        tagline: "ä½ åœ¨æ··äº‚ä¹‹ä¸­ï¼Œå°‹æ‰¾å¯ä»¥è¸å¯¦è¸©ä¸Šçš„åœ°æ¿ã€‚",
        keywords: "ç©©å®š / çµæ§‹ / å¯¦å‹™",
        desc: "ä½ å¤©ç”Ÿé©åˆæŠŠæŠ½è±¡è®Šå…·é«”ï¼ŒæŠŠç†æƒ³è®Šè¨ˆç•«ã€‚ç•¶ä½ é¡˜æ„æ…¢ä¸€é»ã€ç´®å¯¦ä¸€é»ï¼Œä½ å°±æˆäº†åˆ¥äººå¯ä»¥æ”¾å¿ƒä¾é çš„åœ°åŸºã€‚",
        tips: [
          "ä»Šå¤©æ›¿æœªä¾†çš„è‡ªå·±åšä¸€ä»¶å°æ•´ç†ï¼šæ•´ç†æ¡Œé¢ã€æª”æ¡ˆå¤¾æˆ–å¾…è¾¦æ¸…å–®ï¼Œè®“æ˜å¤©çš„ä½ æ›´è¼•é¬†ä¸€äº›ã€‚",
          "ç•¶ä½ è¦ºå¾—ã€Œé€™æ¨£é‚„ä¸å¤ å®Œæ•´ã€æ™‚ï¼Œè©¦è‘—å…ˆå®Œæˆ 60% å°±å¥½ã€‚",
          "ä»Šå¤©åˆ»æ„æ”¾æ…¢ä¸€å€‹å‹•ä½œï¼Œæ¯”å¦‚æ…¢æ…¢æ³¡èŒ¶ã€æ…¢æ…¢èµ°è·¯ï¼Œæ„Ÿå—è¸å¯¦çš„ç¯€å¥ã€‚"
        ]
      },
      5: {
        title: "æ¢ç´¢è€…",
        tagline: "ä¸–ç•Œé‚£éº¼å¤§ï¼Œä½ ç”Ÿä¾†å°±æ˜¯è¦å»çœ‹çœ‹ã€‚",
        keywords: "è‡ªç”± / è®ŠåŒ– / é«”é©—",
        desc: "ä½ ä¸é©åˆè¢«é—œåœ¨å›ºå®šæ¨¡å¼è£¡ã€‚ç•¶ä½ å…è¨±è‡ªå·±å»å˜—è©¦ã€å»èµ°å½è·¯ï¼Œä½ çš„ç”Ÿå‘½æ•…äº‹æœ¬èº«å°±æ˜¯ç¦®ç‰©ã€‚",
        tips: [
          "ä»Šå¤©æ›ä¸€æ¢è·¯å›å®¶ã€æ›ä¸€é–“åº—åƒé£¯ï¼Œè®“è‡ªå·±é«”é©—ä¸€å€‹å¾®å°ä½†çœŸå¯¦çš„ã€ä¸ä¸€æ¨£ã€ã€‚",
          "ç•¶ä½ è¦ºå¾—ã€Œå¥½åƒè©²å®šä¸‹ä¾†ã€æ™‚ï¼Œå•è‡ªå·±ï¼šæ˜¯èª°èªªçš„è©²ï¼Ÿ",
          "ä»Šå¤©åšä¸€ä»¶ä½ ä¸€ç›´æƒ³è©¦ä½†æ²’è©¦éçš„å°äº‹ï¼Œå“ªæ€•åªæ˜¯é»ä¸€æ¯æ²’å–éçš„é£²æ–™ã€‚"
        ]
      },
      6: {
        title: "å®ˆè­·è€…",
        tagline: "ä½ åœ¨æ„çš„ä¸æ˜¯äº‹æƒ…å®Œæˆï¼Œè€Œæ˜¯äººæœ‰æ²’æœ‰è¢«å¥½å¥½ç…§é¡§ã€‚",
        keywords: "ç…§é¡§ / ç¾æ„Ÿ / è²¬ä»»",
        desc: "ä½ æœ‰ä¸€ç¨®å¤©ç„¶çš„ã€æˆ‘ä¾†é¡§ã€èƒ½é‡ã€‚ç•¶ä½ å­¸æœƒå…ˆç…§é¡§è‡ªå·±ï¼Œå†ç…§é¡§åˆ¥äººï¼Œä½ çš„æ„›æœƒè®Šå¾—æ—¢æº«æŸ”åˆæœ‰ç•Œé™ã€‚",
        tips: [
          "ä»Šå¤©å°è‡ªå·±åšä¸€ä»¶ä½ å¹³å¸¸åªæœƒæ›¿åˆ¥äººåšçš„è²¼å¿ƒå°äº‹ï¼Œåƒæ˜¯æº–å‚™å¥½å¥½çš„ä¸€é¤æˆ–ä½ˆç½®è‡ªå·±çš„ç©ºé–“ã€‚",
          "ç•¶ä½ æƒ³è‘—ã€ä»–éœ€è¦æˆ‘ã€æ™‚ï¼Œåœä¸‹ä¾†å•ï¼šã€æˆ‘è‡ªå·±éœ€è¦ä»€éº¼ï¼Ÿã€",
          "ä»Šå¤©å…è¨±è‡ªå·±ä¸å®Œç¾åœ°ç…§é¡§ä¸€ä»¶äº‹ï¼Œ60 åˆ†çš„æº«æŸ”ä¹Ÿæ˜¯æ„›ã€‚"
        ]
      },
      7: {
        title: "æ´è¦‹è€…",
        tagline: "ä½ å¤©ç”Ÿå°±å°ã€çœŸç›¸ã€æœ‰é»ååŸ·ã€‚",
        keywords: "æ€è€ƒ / æ·±åº¦ / éœå¿ƒ",
        desc: "ä½ é©åˆåœ¨å®‰éœè£¡æ•´ç†ä¸–ç•Œã€‚ç•¶ä½ é¡˜æ„ç›¸ä¿¡è‡ªå·±çš„æ´è¦‹ï¼ŒåŒæ™‚ä¹Ÿä¸æ€¥è‘—èªªæœåˆ¥äººï¼Œä½ çš„å­˜åœ¨æœ¬èº«å°±æ˜¯ä¸€ç¨®æ¸…é†’ã€‚",
        tips: [
          "ä»Šå¤©çµ¦è‡ªå·± 10 åˆ†é˜å®‰éœæ™‚é–“ï¼ŒæŠŠæœ€è¿‘åè¦†å‡ºç¾çš„ä¸€å€‹å•é¡Œå¯«ä¸‹ä¾†ï¼Œä¸æ±‚ç­”æ¡ˆï¼Œåªæ±‚å•å¾—æ›´æ¸…æ¥šã€‚",
          "ç•¶ä½ ç™¼ç¾ä¸€å€‹åˆ¥äººæ²’çœ‹è¦‹çš„çŸ›ç›¾ï¼Œä¸å¿…æ€¥è‘—è¬›ï¼Œå…ˆè®“å®ƒåœ¨ä½ å¿ƒè£¡æ²‰æ¾±ä¸€ä¸‹ã€‚",
          "ä»Šå¤©å°ä¸€å€‹ä½ å¾ˆç¢ºå®šçš„æƒ³æ³•èªªï¼šã€ä¹Ÿè¨±æˆ‘éŒ¯äº†ã€ï¼Œç„¶å¾Œè§€å¯Ÿå…§å¿ƒçš„åæ‡‰ã€‚"
        ]
      },
      8: {
        title: "å¯¦ç¾è€…",
        tagline: "ä½ ä¾†ï¼Œæ˜¯ç‚ºäº†æŠŠèƒ½é‡è®Šæˆçœ‹å¾—è¦‹çš„æˆæœã€‚",
        keywords: "å½±éŸ¿åŠ› / è³‡æº / æˆå°±",
        desc: "ä½ å°ã€åšåˆ°ã€ã€å¼„å‡ºçµæœã€æœ‰ä¸€ç¨®æœ¬èƒ½çš„æ•éŠ³ã€‚ç•¶ä½ æŠŠåŠ›é‡ç”¨åœ¨å°é½Šçš„æ–¹å‘ï¼Œè€Œä¸æ˜¯è­‰æ˜è‡ªå·±ï¼Œä¸–ç•Œæœƒå› æ­¤è¢«ä½ å‡ç´šã€‚",
        tips: [
          "ä»Šå¤©æŒ‘ä¸€ä»¶å¡å¾ˆä¹…çš„äº‹æƒ…ï¼Œåˆ»æ„å‘å‰æ¨é€² 10%ï¼Œå“ªæ€•åªæ˜¯æ‰“ä¸€å°ä¿¡ã€åšä¸€å€‹æ±ºå®šã€‚",
          "ç•¶ä½ è¦ºå¾—ã€é€™é‚„ä¸å¤ å¤§ã€æ™‚ï¼Œå•è‡ªå·±ï¼šå¤ ä¸å¤ å¤§æ˜¯èª°å®šç¾©çš„ï¼Ÿ",
          "ä»Šå¤©ç”¨ä½ çš„è³‡æºï¼ˆæ™‚é–“ã€éŒ¢ã€äººè„ˆï¼‰å¹«ä¸€å€‹äººè§£æ±ºä¸€å€‹å°å•é¡Œï¼Œæ„Ÿå—æ–½åŠ›çš„æ„Ÿè¦ºã€‚"
        ]
      },
      9: {
        title: "æ•´åˆè€…",
        tagline: "ä½ çœ‹è¦‹çš„æ˜¯ã€æ•´é«”ã€ï¼Œè€Œä¸æ˜¯å–®ä¸€ç‰‡æ®µã€‚",
        keywords: "æ…ˆæ‚² / è§€ç…§ / å®Œæˆ",
        desc: "ä½ å°äººæ€§æœ‰ä¸€ç¨®å¯¬å»£çš„ç†è§£ã€‚ç•¶ä½ å…è¨±è‡ªå·±æ—¢å¿ƒè»Ÿåˆå¿ƒæ˜ï¼Œä½ å°±èƒ½åœ¨æ··äº‚ä¸­å¸¶å‡ºä¸€ç¨®å¾ˆå®‰éœçš„ç§©åºæ„Ÿã€‚",
        tips: [
          "ä»Šå¤©å›æƒ³ä¸€å€‹ä½ ä¸€ç›´æ”¾ä¸ä¸‹çš„äººæˆ–äº‹ï¼Œå°è‡ªå·±èªªä¸€å¥ï¼šã€æˆ‘å…è¨±é€™å€‹æ•…äº‹æš«æ™‚æ²’æœ‰æ¨™é»ç¬¦è™Ÿã€‚ã€",
          "ç•¶ä½ æ„Ÿè¦ºåˆ°ã€é€™äº›äººæ€éº¼éƒ½ä¸æ‡‚ã€æ™‚ï¼Œè©¦è‘—å•ï¼šã€ä¹Ÿè¨±ä»–å€‘åªæ˜¯ç”¨ä¸åŒæ–¹å¼åœ¨æ‡‚ï¼Ÿã€",
          "ä»Šå¤©å°ä¸€å€‹ä½ å·²ç¶“ç†è§£çš„å‚·ç—›ï¼Œå†å¤šçµ¦å®ƒä¸€é»é»ç©ºé–“ï¼Œä¸æ€¥è‘—æ˜‡è¯ã€‚"
        ]
      }
    };

    // ====== å·¥å…·å‡½å¼ï¼šè¨ˆç®—ç”Ÿå‘½éˆæ•¸ï¼ˆ1~9ï¼‰ ======
    function calculateLifePath(dateStr) {
      if (!dateStr) return null;

      // åªä¿ç•™æ•¸å­—ï¼Œä¾‹å¦‚ "1990-07-15" -> "19900715"
      const digits = dateStr.replace(/\D/g, "");
      if (!digits) return null;

      let sum = 0;
      for (let i = 0; i < digits.length; i++) {
        sum += Number(digits[i]);
      }

      // æŒçºŒæŠŠä½æ•¸ç›¸åŠ ï¼Œç›´åˆ°å‰©ä¸€ä½æ•¸ï¼ˆ1~9ï¼‰
      while (sum > 9) {
        sum = sum
          .toString()
          .split("")
          .reduce((acc, d) => acc + Number(d), 0);
      }

      return sum; // ç›®å‰å…ˆä¸è™•ç† 11/22 ç­‰å¤§å¸«æ•¸ï¼Œä¿æŒ v1 ç°¡å–®
    }

    // ====== å·¥å…·å‡½å¼ï¼šè¨ˆç®—ä»Šæ—¥èƒ½é‡æ•¸å­— ======
    function calculateDailyEnergy() {
      const date = new Date();
      const year = date.getFullYear().toString();
      const month = (date.getMonth() + 1).toString().padStart(2, "0");
      const day = date.getDate().toString().padStart(2, "0");
      const dateStr = year + month + day; // YYYYMMDD

      let sum = 0;
      for (let i = 0; i < dateStr.length; i++) {
        sum += Number(dateStr[i]);
      }

      // æŒçºŒç›¸åŠ ç›´åˆ°å‰©ä¸€ä½æ•¸
      while (sum > 9) {
        sum = sum
          .toString()
          .split("")
          .reduce((acc, d) => acc + Number(d), 0);
      }

      return sum;
    }

    // ====== å·¥å…·å‡½å¼ï¼šå–å¾—çµåˆå»ºè­°ï¼ˆç”Ÿå‘½éˆæ•¸ Ã— ä»Šæ—¥èƒ½é‡ï¼‰ ======
    function getCombinedDailyTip(lifeNumber) {
      const dailyEnergy = calculateDailyEnergy();

      // æª¢æŸ¥ comboTips æ˜¯å¦å­˜åœ¨
      if (!window.comboTips || !window.comboTips[lifeNumber.toString()]) {
        return "ä»Šå¤©ä¹Ÿæ˜¯å¾ˆå¥½çš„ä¸€å¤©ï¼Œè¨˜å¾—å°è‡ªå·±æº«æŸ”ä¸€é»ã€‚";
      }

      const profile = window.comboTips[lifeNumber.toString()];
      return profile[dailyEnergy.toString()] || "ä»Šå¤©ä¹Ÿæ˜¯å¾ˆå¥½çš„ä¸€å¤©ï¼Œè¨˜å¾—å°è‡ªå·±æº«æŸ”ä¸€é»ã€‚";
    }

    // ====== å·¥å…·å‡½å¼ï¼šå–å¾—æ¯æ—¥æç¤ºï¼ˆæ ¹æ“šæ—¥æœŸè¼ªæ›ï¼‰[å·²æ£„ç”¨ï¼Œæ”¹ç”¨ getCombinedDailyTip] ======
    function getDailyTip(lifeNumber) {
      const data = lifeData[lifeNumber];
      if (!data || !data.tips) return data.tip; // fallback

      // ç”¨ä»Šå¤©çš„æ—¥æœŸä¾†æ±ºå®šé¡¯ç¤ºå“ªä¸€æ¢ tip
      const today = new Date();
      const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
      const tipIndex = dayOfYear % data.tips.length;

      return data.tips[tipIndex];
    }

    // ====== å·¥å…·å‡½å¼ï¼šæ¸²æŸ“æ­·å²ç´€éŒ„ ======
    function renderHistory() {
      const logs = loadMoodLogs();
      const historySection = document.getElementById("history-section");
      const historyList = document.getElementById("history-list");

      if (logs.length === 0) {
        historySection.classList.remove("show");
        return;
      }

      // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°åœ¨å‰ï¼‰ï¼Œåªé¡¯ç¤ºæœ€è¿‘ 7 å¤©
      logs.sort((a, b) => b.timestamp - a.timestamp);
      const recentLogs = logs.slice(0, 7);

      const moodEmoji = {
        good: 'ğŸ™‚',
        ok: 'ğŸ˜',
        bad: 'â˜¹ï¸'
      };

      const moodText = {
        good: 'æ„Ÿè¦ºä¸éŒ¯',
        ok: 'æ™®é€šå¹³ç©©',
        bad: 'æœ‰é»å¡ä½'
      };

      historyList.innerHTML = recentLogs.map(log => {
        const date = new Date(log.date);
        const today = new Date();
        const isToday = log.date === today.toISOString().split('T')[0];
        const dateStr = isToday ? 'ä»Šå¤©' : `${date.getMonth() + 1}/${date.getDate()}`;

        return `
          <div class="history-item">
            <span class="history-date">${dateStr}</span>
            <span class="history-mood">${moodEmoji[log.mood]}</span>
            <span class="history-text">${moodText[log.mood]}</span>
          </div>
        `;
      }).join('');

      historySection.classList.add("show");
    }

    // ====== å·¥å…·å‡½å¼ï¼šæ›´æ–°é€£çºŒå¤©æ•¸é¡¯ç¤º ======
    function updateStreakDisplay() {
      const streak = calculateStreak();
      const streakBadge = document.getElementById("streak-badge");

      if (streak > 0) {
        streakBadge.textContent = `ğŸ”¥ ${streak} å¤©`;
        streakBadge.style.display = 'block';
      } else {
        streakBadge.style.display = 'none';
      }
    }

    // ====== ç¶å®šç•«é¢å…ƒç´  ======
    const birthInput = document.getElementById("birthdate");
    const calcBtn = document.getElementById("calc-btn");

    const resultCard = document.getElementById("result-card");
    const lifeNumberEl = document.getElementById("life-number");
    const lifeTitleEl = document.getElementById("life-title");
    const lifeTaglineEl = document.getElementById("life-tagline");
    const lifeKeywordsEl = document.getElementById("life-keywords");
    const lifeDescEl = document.getElementById("life-desc");
    const lifeTipEl = document.getElementById("life-tip");
    const moodButtons = document.querySelectorAll(".mood-buttons button");
    const moodNoteEl = document.getElementById("mood-note");

    // ====== é é¢è¼‰å…¥æ™‚çš„åˆå§‹åŒ– ======
    window.addEventListener('DOMContentLoaded', () => {
      // è¼‰å…¥ä¹‹å‰å­˜çš„ç”Ÿæ—¥
      const savedBirthdate = loadBirthdate();
      if (savedBirthdate) {
        birthInput.value = savedBirthdate;

        // è‡ªå‹•è¨ˆç®—ä¸¦é¡¯ç¤ºçµæœ
        const num = loadLifeNumber();
        if (num) {
          const data = lifeData[num];
          if (data) {
            lifeNumberEl.textContent = num;
            lifeTitleEl.textContent = data.title;
            lifeTaglineEl.textContent = data.tagline;
            lifeKeywordsEl.textContent = data.keywords;
            lifeDescEl.textContent = data.desc;

            // é¡¯ç¤ºä»Šæ—¥èƒ½é‡
            const dailyEnergy = calculateDailyEnergy();
            const dailyEnergyNumEl = document.getElementById("daily-energy-num");
            const dailyEnergyNameEl = document.getElementById("daily-energy-name");
            dailyEnergyNumEl.textContent = dailyEnergy;
            dailyEnergyNameEl.textContent = window.energyNames
              ? window.energyNames[dailyEnergy.toString()]
              : dailyEnergy;

            // ä½¿ç”¨çµåˆå»ºè­°
            lifeTipEl.textContent = getCombinedDailyTip(num);
            resultCard.classList.add("show");
          }
        }
      }

      // æª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²ç¶“è¨˜éŒ„éå¿ƒæƒ…
      const logs = loadMoodLogs();
      const today = new Date().toISOString().split('T')[0];
      const todayLog = logs.find(log => log.date === today);

      if (todayLog) {
        // è‡ªå‹•é¸ä¸­ä»Šå¤©è¨˜éŒ„çš„å¿ƒæƒ…
        moodButtons.forEach(btn => {
          if (btn.getAttribute('data-mood') === todayLog.mood) {
            btn.classList.add('selected');
          }
        });
        moodNoteEl.textContent = 'âœ“ ä»Šå¤©å·²ç¶“è¨˜éŒ„éäº†ï¼Œå¯ä»¥éš¨æ™‚æ›´æ–°ã€‚';
      }

      // æ¸²æŸ“æ­·å²å’Œé€£çºŒå¤©æ•¸
      renderHistory();
      updateStreakDisplay();
    });

    // ====== é»æ“Šè¨ˆç®—äº‹ä»¶ ======
    calcBtn.addEventListener("click", () => {
      const dateStr = birthInput.value;
      const num = calculateLifePath(dateStr);

      if (!num) {
        alert("å…ˆé¸æ“‡ä½ çš„ç”Ÿæ—¥å–” :)");
        return;
      }

      const data = lifeData[num];
      if (!data) {
        alert("æš«æ™‚åªæ”¯æ´ 1â€“9 çš„éˆæ•¸è¨ˆç®—ã€‚");
        return;
      }

      // å„²å­˜ç”Ÿæ—¥å’Œéˆæ•¸
      saveBirthdate(dateStr);
      saveLifeNumber(num);

      // æ›´æ–°ç”Ÿå‘½éˆæ•¸é¡¯ç¤º
      lifeNumberEl.textContent = num;
      lifeTitleEl.textContent = data.title;
      lifeTaglineEl.textContent = data.tagline;
      lifeKeywordsEl.textContent = data.keywords;
      lifeDescEl.textContent = data.desc;

      // é¡¯ç¤ºä»Šæ—¥èƒ½é‡
      const dailyEnergy = calculateDailyEnergy();
      const dailyEnergyNumEl = document.getElementById("daily-energy-num");
      const dailyEnergyNameEl = document.getElementById("daily-energy-name");
      dailyEnergyNumEl.textContent = dailyEnergy;
      dailyEnergyNameEl.textContent = window.energyNames
        ? window.energyNames[dailyEnergy.toString()]
        : dailyEnergy;

      // ä½¿ç”¨çµåˆå»ºè­°
      lifeTipEl.textContent = getCombinedDailyTip(num);

      resultCard.classList.add("show");

      // æª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²ç¶“è¨˜éŒ„é
      const logs = loadMoodLogs();
      const today = new Date().toISOString().split('T')[0];
      const todayLog = logs.find(log => log.date === today);

      if (todayLog) {
        moodButtons.forEach(btn => {
          if (btn.getAttribute('data-mood') === todayLog.mood) {
            btn.classList.add('selected');
          } else {
            btn.classList.remove('selected');
          }
        });
        moodNoteEl.textContent = 'âœ“ ä»Šå¤©å·²ç¶“è¨˜éŒ„éäº†ï¼Œå¯ä»¥éš¨æ™‚æ›´æ–°ã€‚';
      } else {
        moodButtons.forEach((btn) => btn.classList.remove("selected"));
        moodNoteEl.textContent = "ï¼ˆé¸ä¸€å€‹è¡¨æƒ…ï¼Œè¨˜éŒ„ä¸€ä¸‹ä»Šå¤©çš„ä½ ï¼‰";
      }
    });

    // ====== æƒ…ç·’é¸æ“‡äº‹ä»¶ ======
    moodButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const currentLifeNumber = loadLifeNumber();
        if (!currentLifeNumber) {
          alert("è«‹å…ˆè¨ˆç®—ä½ çš„ç”Ÿå‘½éˆæ•¸ :)");
          return;
        }

        moodButtons.forEach((b) => b.classList.remove("selected"));
        btn.classList.add("selected");
        const mood = btn.getAttribute("data-mood");

        // å„²å­˜å¿ƒæƒ…è¨˜éŒ„
        saveMoodLog(mood, currentLifeNumber);

        // æ›´æ–°é¡¯ç¤º
        const streak = calculateStreak();
        let text = "";

        if (mood === "good") {
          text = "ä»Šå¤©è¦ºå¾—é‚„ä¸éŒ¯";
          if (streak > 1) text += `ï¼Œå·²ç¶“é€£çºŒè¨˜éŒ„ ${streak} å¤©äº†ï¼`;
        }
        if (mood === "ok") {
          text = "ä»Šå¤©æ˜¯æ™®é€šçš„ä¸€å¤©";
          if (streak > 1) text += `ï¼Œå …æŒè¨˜éŒ„ ${streak} å¤©å¾ˆæ£’`;
        }
        if (mood === "bad") {
          text = "ä»Šå¤©æœ‰é»å¡ï¼Œæ²’é—œä¿‚";
          if (streak > 1) text += `ï¼Œ${streak} å¤©çš„ä½ éƒ½æ’éä¾†äº†`;
        }

        moodNoteEl.textContent = text + "ã€‚";

        // é‡æ–°æ¸²æŸ“æ­·å²å’Œé€£çºŒå¤©æ•¸
        renderHistory();
        updateStreakDisplay();
      });
    });
  </script>
</body>
</html>
